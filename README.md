# AzureFn_AddMonth
AddMonths to an existing datetime using Azure Functions. This can be used by Azure Data Factory (Web Activity) to fetch the  new date based on the requirements (specified in the POST body - original_dateTime and addMonths)

*Note: Publish this Azure Functions Solution from Visual Studio. Ensure Tools for Azure Functions is pre-installed in your visual studio.*

*Note: The [Functions logic for computing the new date](https://github.com/nabhishek/AzureFn_AddMonth/blob/master/AzureFn_AddMonth/CalculateDateTime.cs) assumes date is passed in yyyy-MM-dd format. You can modify it accordinly to suite your logic.*

### Sample HTTP POST message URL generated by hosting this Azure Functions):

POST URL: https://*FunctionAppsName*.azurewebsites.net/api/*functionName*?code=SowetfeFLPaOdX/uFcBLfKEaPtt9XeNctuTWdJTeXgrO3djnPKpgwe==

Content-Type: application/json
 
```json
{
  "original_dateTime":"2012-12-1",
  "addMonths_value":"-12"
}
```
### Sample HTTP response:
```json
{
  "newDate": "2011-12-01"
}
```

## Configure Azure Data Factory - Web Activity
Web Activity can do a HTTP Post call to Functions and pass the above JSON payload.

### Sample JSON of a Web Activity 
```json
 "name": "WebActivity_DateFunction",
    "properties": {
        "activities": [
            {
                "name": "Web1",
                "type": "WebActivity",
                "policy": {
                    "timeout": "7.00:00:00",
                    "retry": 0,
                    "retryIntervalInSeconds": 30,
                    "secureOutput": false
                },
                "typeProperties": {
                    "url": "https://FunctionAppsName.azurewebsites.net/api/functionName?code=SowetfeFLPaOdX/uFcBLfKEaPtt9XeNctuTWdJTeXgrO3djnPKpgwe==",
                    "method": "POST",
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": {
                        "value": "@concat('{\"original_dateTime\":\"',pipeline().parameters.DateTimeValue,'\",\"addMonths_value\":\"',pipeline().parameters.AddMonths,'\"}')",
                        "type": "Expression"
                    }
                }
            }
		       ],
        "parameters": {
            "DateTimeValue": {
                "type": "String",
                "defaultValue": "2012-12-1"
            },
            "AddMonths": {
                "type": "String",
                "defaultValue": "-12"
            }
        } 
    }
}
```
